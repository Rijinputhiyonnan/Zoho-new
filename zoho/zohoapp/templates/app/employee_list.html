{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
    /* Your existing styles here */

    /* Additional styles for the popup */
    .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 1rem;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .popup h4 {
        margin-top: 0;
    }

    .popup-buttons {
        display: flex;
        justify-content: flex-end;
        margin-top: 1rem;
    }

    .popup-buttons button {
        margin-left: 1rem;
    }
</style>

<section>
    <div class="containerprof p-3">
        <!-- Your existing content -->

        <table class="table" id="mytable">
            <thead>
                <tr id="ckeck_th">
                    <th scope="col">DATE</th>
                    <th scope="col">NAME</th>
                    <th scope="col">EMAIL</th>
                    <th scope="col">EMPLOYEE NUMBER</th>
                    <th scope="col">LOAN AMOUNT</th>
                    <th scope="col">EXPIRY DATE</th>
                    <th scope="col">ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                    <tr>
                        <td class="pt-3">{{ employee.joindate }}</td>
                        <td class="pt-3">{{ employee.first_name }} {{ employee.last_name }}</td>
                        <td class="pt-3">{{ employee.email }}</td>
                        <td class="pt-3">{{ employee.employee_number }}</td>
                        <td class="pt-3">{{ employee.loan.loan_amount }}</td>
                        <td class="pt-3">{{ employee.loan.expiry_date }}</td>
                        <td class="pt-3">
                            <a href="#" class="delete-link" data-id="{{ employee.id }}">
                                <i class="fa fa-trash text-danger" style="font-size: large;"></i>
                            </a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</section>

<!-- Popup for delete confirmation -->
<div class="popup" id="deletePopup">
    <h4>Confirm Delete</h4>
    <p>Are you sure you want to delete this employee's loan?</p>
    <div class="popup-buttons">
        <button id="confirmDelete">Delete</button>
        <button id="cancelDelete">Cancel</button>
    </div>
</div>

<script>
    // Your existing scripts here

    // Open the delete confirmation popup when clicking the delete icon
    const deleteLinks = document.querySelectorAll('.delete-link');
    const deletePopup = document.getElementById('deletePopup');
    const confirmDeleteButton = document.getElementById('confirmDelete');
    const cancelDeleteButton = document.getElementById('cancelDelete');
    let currentDeleteId = null;

    deleteLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            currentDeleteId = this.getAttribute('data-id');
            deletePopup.style.display = 'block';
        });
    });

    // Close the delete confirmation popup
    cancelDeleteButton.addEventListener('click', function() {
        deletePopup.style.display = 'none';
        currentDeleteId = null;
    });

    // Perform the delete action when confirming
    confirmDeleteButton.addEventListener('click', function() {
        if (currentDeleteId !== null) {
            // Redirect to the delete URL (replace 'your_delete_url' with the actual URL)
            window.location.href = `/delete_employee_loan/${currentDeleteId}/`;
        }
    });
</script>
{% endblock %}
